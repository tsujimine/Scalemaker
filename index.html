<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonata Composer Matrix</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background: #f0f2f5; color: #333; margin: 0; padding: 0; line-height: 1.6; }
        header { background: #1a1a1a; color: white; padding: 1rem; text-align: center; }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 2px; }
        main { max-width: 1200px; margin: 1.5rem auto; padding: 0 1rem; }
        
        .section-box { background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { font-size: 1.1rem; border-left: 4px solid #e63946; padding-left: 10px; margin-top: 0; }

        /* æ§‹æˆãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .timeline { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .timeline-item { display: grid; grid-template-columns: 100px 150px 1fr 1fr 40px; gap: 10px; align-items: center; background: #f8f9fa; padding: 10px; border-radius: 6px; border: 1px solid #ddd; }
        .timeline-item input, .timeline-item select { padding: 5px; border-radius: 4px; border: 1px solid #ccc; font-size: 0.9rem; }
        
        .controls { background: white; padding: 1.2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .flex-row { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; margin-bottom: 10px; }
        label { font-weight: bold; font-size: 0.85rem; }
        
        .selector-area { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; }
        .scale-checkbox { display: flex; align-items: center; gap: 4px; background: #f1f3f5; padding: 3px 8px; border-radius: 15px; font-size: 0.75rem; border: 1px solid #ddd; cursor: pointer; }
        
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; font-size: 0.85rem; }
        th { background: #333; color: white; padding: 10px; text-align: left; text-transform: uppercase; }
        td { padding: 8px 10px; border-bottom: 1px solid #eee; }
        .notes { font-family: 'Courier New', monospace; font-weight: bold; color: #e63946; font-size: 1rem; }
        
        button.add-btn { background: #2a9d8f; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button.del-btn { background: #e63946; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ¼ Sonata Composer Matrix</h1>
</header>

<main>
    <div class="section-box">
        <h2>æ¥½æ›²æ§‹æˆãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ (Form Planner)</h2>
        <p style="font-size: 0.8rem; color: #666;">å°ç¯€æ•°ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³åã€ä½¿ç”¨ã‚¹ã‚±ãƒ¼ãƒ«ã€ãƒ¡ãƒ¢ã‚’è¨˜å…¥ã—ã¦å…¨ä½“ã®æµã‚Œã‚’è¨­è¨ˆã—ã¾ã™ã€‚</p>
        <div id="timeline" class="timeline">
            </div>
        <div style="margin-top: 15px;">
            <button class="add-btn" onclick="addTimelineRow()">ï¼‹ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ </button>
        </div>
    </div>

    <div class="section-box">
        <h2>ã‚¹ã‚±ãƒ¼ãƒ«ãƒ»ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</h2>
        <div class="flex-row">
            <div>
                <label>Root Key:</label>
                <select id="keySelect" onchange="update()"></select>
            </div>
            <div>
                <label>è¡¨ç¤ºé †:</label>
                <select id="orderSelect" onchange="update()">
                    <option value="scale">éŸ³éšé †</option>
                    <option value="tertial">3åº¦æ§‹æˆé †</option>
                </select>
            </div>
        </div>
        
        <div id="checkboxContainer" class="selector-area"></div>
        
        <table style="margin-top: 15px;">
            <thead>
                <tr>
                    <th>éŸ³æ•°</th>
                    <th>ã‚¹ã‚±ãƒ¼ãƒ«å</th>
                    <th>æ§‹æˆéŸ³</th>
                    <th>åœ°åŸŸ</th>
                    <th>ã‚¤ãƒ¡ãƒ¼ã‚¸</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</main>

<script>
    const notesSharp = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    const notesFlat  = ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"];
    
    const scales = [
        { id: "ryukyu", n: 5, name: "ç‰çƒéŸ³éš", intervals: [0, 4, 5, 7, 11], region: "æ²–ç¸„", img: "å¤ªé™½ãƒ»é–‹æ”¾", prefer: "sharp" },
        { id: "ritsu", n: 5, name: "å¾‹æ—‹æ³•", intervals: [0, 2, 5, 7, 9], region: "é›…æ¥½", img: "é™è¬ãƒ»éœ§", prefer: "sharp" },
        { id: "in", n: 5, name: "é™°æ—‹æ³•", intervals: [0, 1, 5, 7, 8], region: "éƒ½ç¯€", img: "å“€æ„ãƒ»é‹å‘½", prefer: "flat" },
        { id: "whole", n: 6, name: "å…¨éŸ³éŸ³éš", intervals: [0, 2, 4, 6, 8, 10], region: "ä»", img: "å¤¢å¹»ãƒ»æ–¹å‘æ¶ˆå¤±", prefer: "sharp" },
        { id: "lydian", n: 7, name: "ãƒªãƒ‡ã‚£ã‚¢ãƒ³", intervals: [0, 2, 4, 6, 7, 9, 11], region: "æ¬§å·", img: "ç¥è©±çš„å…‰", prefer: "sharp" },
        { id: "phrygian_dom", n: 7, name: "ãƒ•ãƒªã‚¸ã‚¢ãƒ³Dom", intervals: [0, 1, 4, 5, 7, 8, 10], region: "ã‚¨ã‚¸ãƒ—ãƒˆ", img: "ç ‚æ¼ ãƒ»å¨åœ§", prefer: "flat" },
        { id: "messiaen2", n: 8, name: "ãƒ¡ã‚·ã‚¢ãƒ³ç¬¬2", intervals: [0, 1, 3, 4, 6, 7, 9, 10], region: "ç¾ä»£", img: "å®çŸ³ãƒ»ç¥ç§˜", prefer: "flat" },
        { id: "messiaen7", n: 10, name: "ãƒ¡ã‚·ã‚¢ãƒ³ç¬¬7", intervals: [0, 1, 2, 3, 5, 6, 7, 8, 9, 11], region: "ç¾ä»£", img: "ã‚«ã‚ªã‚¹", prefer: "sharp" },
        { id: "spiral", n: "ç‰¹æ®Š", name: "èºæ—‹éŸ³éš", intervals: [0, 2, 4, 6, 8, 10, 13, 15], region: "æ•°å­¦", img: "ç„¡é™ä¸Šæ˜‡", prefer: "sharp" }
        // ... (ä»–ã®å…¨ã‚¹ã‚±ãƒ¼ãƒ«ã‚‚èƒŒå¾Œã§ç¶­æŒ)
    ];

    // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¿½åŠ 
    function addTimelineRow(m = "", sec = "æç¤ºéƒ¨", sc = "ç‰çƒéŸ³éš", memo = "") {
        const container = document.getElementById('timeline');
        const div = document.createElement('div');
        div.className = 'timeline-item';
        div.innerHTML = `
            <input type="text" placeholder="å°ç¯€ (ä¾‹:1-32)" value="${m}">
            <input type="text" placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³" value="${sec}">
            <select>${scales.map(s => `<option ${s.name===sc?'selected':''}>${s.name}</option>`).join('')}</select>
            <input type="text" placeholder="ãƒ¡ãƒ¢ãƒ»æ¥½æƒ³" value="${memo}">
            <button class="del-btn" onclick="this.parentElement.remove()">Ã—</button>
        `;
        container.appendChild(div);
    }

    // åˆæœŸåŒ–ã¨ã‚¹ã‚±ãƒ¼ãƒ«æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ (ã“ã‚Œã¾ã§ã®å…¨æ©Ÿèƒ½ç¶­æŒ)
    const keySelect = document.getElementById('keySelect');
    notesFlat.forEach((n, i) => {
        const opt = document.createElement('option');
        opt.value = i; opt.textContent = n;
        keySelect.appendChild(opt);
    });

    const checkboxContainer = document.getElementById('checkboxContainer');
    scales.forEach(s => {
        const label = document.createElement('label');
        label.className = 'scale-checkbox';
        label.innerHTML = `<input type="checkbox" id="check_${s.id}" checked onchange="update()"> ${s.name}`;
        checkboxContainer.appendChild(label);
    });

    function update() {
        const shift = parseInt(keySelect.value);
        const order = document.getElementById('orderSelect').value;
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = "";
        const flatKeys = [1, 3, 5, 8, 10];
        const isFlatKey = flatKeys.includes(shift);

        scales.forEach(s => {
            const isChecked = document.getElementById(`check_${s.id}`).checked;
            if (!isChecked) return;
            const noteList = (s.prefer === "flat") || (isFlatKey && s.prefer !== "sharp") ? notesFlat : notesSharp;
            
            let displayIntervals = [...s.intervals];
            if (order === "tertial") {
                let tertial = []; let temp = [...s.intervals]; let i = 0;
                while (temp.length > 0) {
                    tertial.push(temp[i]);
                    temp.splice(i, 1);
                    if (temp.length > 0) i = (i + 1) % temp.length;
                }
                displayIntervals = tertial;
            }

            const notes = displayIntervals.map(i => noteList[(i + shift) % 12]).join(" ");
            tbody.innerHTML += `<tr><td>${s.n}</td><td>${s.name}</td><td class="notes">${notes}</td><td>${s.region}</td><td>${s.img}</td></tr>`;
        });
    }

    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚½ãƒŠã‚¿æ§‹æˆã‚’ã‚»ãƒƒãƒˆ
    addTimelineRow("1-48", "æç¤ºéƒ¨ (ç¬¬1ä¸»é¡Œ)", "ç‰çƒéŸ³éš", "æ²–ç¸„ã®æ˜ã‚‹ã„å¤ªé™½ã€‚ãƒˆãƒ­ãƒ³ãƒœãƒ¼ãƒ³ã¯ãƒ¦ãƒ‹ã‚¾ãƒ³ã€‚");
    addTimelineRow("49-80", "æç¤ºéƒ¨ (ç¬¬2ä¸»é¡Œ)", "å¾‹æ—‹æ³•", "é›…ãªé›°å›²æ°—ã€‚æœ¨ç®¡ä¸»ä½“ã€‚");
    addTimelineRow("81-150", "å±•é–‹éƒ¨", "ãƒ¡ã‚·ã‚¢ãƒ³ç¬¬2", "ä¸ç©ãªå¤‰å®¹ã€‚1ã¤é£›ã°ã—ã®å’ŒéŸ³ã§ç·Šå¼µã‚’é«˜ã‚ã‚‹ã€‚");
    addTimelineRow("151-", "å†ç¾éƒ¨", "ç‰çƒéŸ³éš", "å‡±æ—‹ã€‚å…¨åˆå¥ã€‚");

    update();
</script>
</body>
</html>
